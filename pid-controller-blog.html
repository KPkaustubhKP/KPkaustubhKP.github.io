<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementing a Digital PID Controller in Verilog</title>
    <meta name="description" content="My experience developing a digital PID controller in Verilog for FPGA: RTL challenges, overflow issues, and lessons learned.">
    <link rel="stylesheet" href="style.css">
    <style>
        .blog-post { max-width: 800px; margin: 0 auto; padding: 2rem; line-height: 1.7; }
        .blog-post h1 { font-size: 2.5rem; margin-bottom: 1rem; color: var(--text-primary); }
        .blog-post h2 { font-size: 1.8rem; margin: 2rem 0 1rem; color: var(--text-primary); }
        .blog-post p { margin-bottom: 1.2rem; color: var(--text-secondary); }
        .blog-meta { border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 2rem; color: var(--text-muted); font-size: 0.9rem; }
        .back-link { display: inline-flex; align-items: center; margin-bottom: 2rem; color: var(--accent-color); text-decoration: none; font-size: 0.9rem; }
        .code-block { background: var(--code-bg); padding: 1rem; border-radius: 4px; overflow-x: auto; font-family: Menlo, monospace; }
        .highlight { background-color: rgba(255,233,0,0.2); padding: 0.2rem; }
    </style>
</head>
<body>
    <nav class="navbar" id="navbar"> <!-- navigation same as other post -->
        <div class="nav-container">
            <div class="nav-brand"><a href="index.html" class="nav-logo">KP</a></div>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="index.html#home" class="nav-link">Home</a></li>
                <li><a href="index.html#about" class="nav-link">About</a></li>
                <li><a href="index.html#projects" class="nav-link">Projects</a></li>
                <li><a href="index.html#skills" class="nav-link">Skills</a></li>
                <li><a href="blogs.html" class="nav-link">Blogs</a></li>
                <li><a href="index.html#resume" class="nav-link">Resume</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
            <div class="nav-controls">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme"><span class="theme-toggle-icon">üåô</span></button>
            </div>
            <div class="nav-hamburger" id="nav-hamburger"><span></span><span></span><span></span></div>
        </div>
    </nav>
    <div class="container">
        <article class="blog-post">
            <a href="blogs.html" class="back-link">‚Üê Back to Blogs</a>
            <h1>Digital PID Controller in Verilog: Tackling RTL and Overflow Challenges</h1>
            <div class="blog-meta">Published on September 24, 2025 ‚Ä¢ 4 min read ‚Ä¢ VLSI Design</div>
            <p>Designing a digital PID controller in Verilog pushed my RTL coding skills to the limit. While translating PID equations into hardware, I ran into subtle <strong>overflow</strong> and <strong>fixed-point</strong> scaling issues that broke simulation and synthesis until I understood the root causes.</p>
            <h2>RTL Architecture and Fixed-Point Representation</h2>
            <p>The core PID formula combines proportional, integral, and derivative terms. In hardware, I implemented each term as a 16-bit signed fixed-point value (8 integer bits, 8 fractional bits). My initial Verilog snippet looked like this:</p>
            <div class="code-block">
<pre><code>assign err = setpoint - feedback;
assign P   = Kp * err;
assign I   = integral + Ki * err;
assign D   = Kd * (err - prev_err);
assign output = P + I + D;
</code></pre>
            </div>
            <p>At first, everything synthesized cleanly, but <strong>functional simulation</strong> showed wrap-around artifacts whenever values exceeded the 16-bit range. The integral term grew unbounded, causing <span class="highlight">I</span> to overflow and corrupt the output.</p>
            <h2>Detecting and Preventing Overflow</h2>
            <p>The solution required adding <strong>saturation logic</strong> around each term. For example, after computing the integral update, I clamped the result:</p>
            <div class="code-block">
<pre><code>wire signed [17:0] int_calc = integral + (Ki * err);
always @(posedge clk) begin
  if (int_calc >  18'sh7FFF) integral <= 16'sh7FFF;
  else if (int_calc < 18'sh8000) integral <= 16'sh8000;
  else integral <= int_calc[15:0];
end
</code></pre>
            </div>
            <p>This approach ensured the <strong>integral term</strong> remained within bounds, preventing downstream overflow when summing P, I, and D. I applied similar saturation to the proportional and derivative outputs.</p>
            <h2>Pipeline and Timing Considerations</h2>
            <p>Adding multipliers and saturation logic increased the critical path. My first FPGA implementation failed timing. To fix this, I pipelined the multiplier outputs and separated the adders into dedicated stages:</p>
            <ul>
                <li>Stage 1: Compute <code>P, I, D</code> with saturation</li>
                <li>Stage 2: Sum <code>P+I</code></li>
                <li>Stage 3: Add <code>D</code> to form final output</li>
            </ul>
            <p>Pipelining reduced the maximum combinatorial delay, meeting timing at 50 MHz clock rate.</p>
            <h2>Lessons Learned</h2>
            <p>This project taught me three key lessons:</p>
            <p><strong>‚Ä¢ Fixed-Point Precision:</strong> Always define bit-widths and fractional scaling clearly to avoid unexpected wrap-around.</p>
            <p><strong>‚Ä¢ Overflow Handling:</strong> Saturation logic is essential for robust control loops.</p>
            <p><strong>‚Ä¢ Pipelining:</strong> Breaking logic into stages helps meet FPGA timing constraints.</p>
            <h2>Conclusion</h2>
            <p>Implementing a PID controller in hardware is more than translating math‚Äîit‚Äôs about managing data widths, preventing overflow, and balancing performance with resource usage. Overcoming these RTL challenges deepened my understanding of digital design fundamentals and prepared me for more complex control systems in future FPGA projects.</p>
        </article>
    </div>
    <footer class="footer">
        <div class="container"><p>&copy; 2025 Kaustubh Pandey. Built with passion for VLSI design and innovation.</p></div>
    </footer>
    <script src="app.js"></script>
</body>
</html>